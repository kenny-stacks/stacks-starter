---
phase: 04-smart-contract-integration
plan: 03
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified:
  - front-end/src/components/counter-display.tsx
  - front-end/src/app/page.tsx
autonomous: false

must_haves:
  truths:
    - "Counter display shows real value from contract"
    - "Increment button submits transaction when clicked"
    - "Decrement button submits transaction when clicked"
    - "Buttons disabled when wallet not connected or transaction pending"
    - "Transaction status visible while pending"
  artifacts:
    - path: "front-end/src/components/counter-display.tsx"
      provides: "Connected counter UI with working buttons"
      min_lines: 60
    - path: "front-end/src/app/page.tsx"
      provides: "Page with counter hooks wired"
      min_lines: 20
  key_links:
    - from: "front-end/src/components/counter-display.tsx"
      to: "front-end/src/hooks/counterQueries.ts"
      via: "useIncrementCounter/useDecrementCounter hooks"
      pattern: "useIncrementCounter|useDecrementCounter"
    - from: "front-end/src/app/page.tsx"
      to: "front-end/src/hooks/counterQueries.ts"
      via: "useCounterValue hook"
      pattern: "useCounterValue"
---

<objective>
Wire counter hooks to UI components and verify end-to-end flow.

Purpose: Complete the Phase 4 integration by connecting hooks to CounterDisplay component and page. Includes human verification checkpoint to confirm transactions work on devnet.

Output: Working counter UI that reads/writes to smart contract
</objective>

<execution_context>
@/Users/kenny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kenny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-smart-contract-integration/04-RESEARCH.md

# Prior plan outputs (hooks created in 04-02)
@front-end/src/hooks/counterQueries.ts
@front-end/src/hooks/useTransactionStatus.ts

# Existing components to update
@front-end/src/components/counter-display.tsx
@front-end/src/app/page.tsx
@front-end/src/components/providers/wallet-provider.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update CounterDisplay with mutation hooks and transaction status</name>
  <files>front-end/src/components/counter-display.tsx</files>
  <action>
Update CounterDisplay to use mutation hooks and show transaction status:

```typescript
"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import {
  Card,
  CardContent,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle,
} from "@/components/ui/card"
import { Skeleton } from "@/components/ui/skeleton"
import { useWallet } from "@/components/providers/wallet-provider"
import { useIncrementCounter, useDecrementCounter } from "@/hooks/counterQueries"
import { useTransactionStatus } from "@/hooks/useTransactionStatus"
import { Loader2 } from "lucide-react"

interface CounterDisplayProps {
  value?: number
  isLoading?: boolean
}

export function CounterDisplay({ value = 0, isLoading = false }: CounterDisplayProps) {
  const { isConnected } = useWallet()
  const [pendingTxId, setPendingTxId] = useState<string | null>(null)

  const incrementMutation = useIncrementCounter()
  const decrementMutation = useDecrementCounter()
  const { data: txStatus } = useTransactionStatus(pendingTxId)

  // Clear pending tx when confirmed or failed
  if (txStatus?.isConfirmed || txStatus?.isFailed) {
    if (pendingTxId) setPendingTxId(null)
  }

  const handleIncrement = async () => {
    try {
      const result = await incrementMutation.mutateAsync()
      setPendingTxId(result.txid)
    } catch {
      // Error handled by mutation onError
    }
  }

  const handleDecrement = async () => {
    try {
      const result = await decrementMutation.mutateAsync()
      setPendingTxId(result.txid)
    } catch {
      // Error handled by mutation onError
    }
  }

  const isPending = incrementMutation.isPending || decrementMutation.isPending || !!pendingTxId
  const buttonsDisabled = !isConnected || isPending

  if (isLoading) {
    return (
      <Card className="w-full max-w-sm">
        <CardHeader>
          <Skeleton className="h-6 w-32" />
          <Skeleton className="h-4 w-48" />
        </CardHeader>
        <CardContent>
          <Skeleton className="h-16 w-24" />
        </CardContent>
        <CardFooter>
          <Skeleton className="h-10 w-full" />
        </CardFooter>
      </Card>
    )
  }

  return (
    <Card className="w-full max-w-sm">
      <CardHeader>
        <CardTitle>Counter Value</CardTitle>
        <CardDescription>
          {pendingTxId ? (
            <span className="flex items-center gap-2">
              <Loader2 className="size-3 animate-spin" />
              Transaction pending...
            </span>
          ) : !isConnected ? (
            "Connect wallet to interact"
          ) : (
            "Current value from smart contract"
          )}
        </CardDescription>
      </CardHeader>
      <CardContent>
        <p className="text-6xl font-bold tabular-nums">{value}</p>
      </CardContent>
      <CardFooter className="flex gap-2">
        <Button
          variant="outline"
          onClick={handleDecrement}
          disabled={buttonsDisabled || value === 0}
        >
          {decrementMutation.isPending && <Loader2 className="mr-2 size-4 animate-spin" />}
          - Decrement
        </Button>
        <Button
          onClick={handleIncrement}
          disabled={buttonsDisabled}
        >
          {incrementMutation.isPending && <Loader2 className="mr-2 size-4 animate-spin" />}
          + Increment
        </Button>
      </CardFooter>
    </Card>
  )
}
```

Key implementation details:
- Track pendingTxId state to monitor transaction after mutation completes
- Disable buttons when wallet not connected, mutation pending, or tx pending
- Disable decrement when value is 0 (contract will reject with underflow error)
- Show loading spinner in button during mutation
- Show "Transaction pending..." message while waiting for confirmation
- Clear pendingTxId when transaction confirms or fails
- Use Loader2 icon from lucide-react for spinner (already in project)
  </action>
  <verify>TypeScript compiles: `cd /Users/kenny/Code/stacks-starter/front-end && pnpm tsc --noEmit`</verify>
  <done>CounterDisplay uses mutation hooks, shows transaction status, disables buttons appropriately</done>
</task>

<task type="auto">
  <name>Task 2: Wire page.tsx to use useCounterValue hook</name>
  <files>front-end/src/app/page.tsx</files>
  <action>
Update page.tsx to fetch real counter value:

```typescript
"use client"

import { Navbar } from "@/components/navbar"
import { CounterDisplay } from "@/components/counter-display"
import { NetworkIndicator } from "@/components/network-indicator"
import { useWallet } from "@/components/providers/wallet-provider"
import { useCounterValue } from "@/hooks/counterQueries"

export default function Home() {
  const { network } = useWallet()
  const { data: counterValue, isLoading, isError } = useCounterValue()

  return (
    <div className="min-h-screen bg-background">
      <Navbar />
      <main className="container py-8">
        <div className="flex flex-col items-center gap-6">
          <div className="flex items-center gap-2">
            <span className="text-sm text-muted-foreground">Network:</span>
            <NetworkIndicator network={network} />
          </div>
          <CounterDisplay
            value={isError ? 0 : counterValue}
            isLoading={isLoading}
          />
          {isError && (
            <p className="text-sm text-destructive">
              Failed to fetch counter value. Is devnet running?
            </p>
          )}
        </div>
      </main>
    </div>
  )
}
```

Key changes:
- Import and use useCounterValue hook
- Pass real value and loading state to CounterDisplay
- Show error message if contract query fails (helpful for devnet troubleshooting)
- Default to 0 on error to prevent undefined display
  </action>
  <verify>TypeScript compiles: `cd /Users/kenny/Code/stacks-starter/front-end && pnpm tsc --noEmit`</verify>
  <done>page.tsx fetches counter value from contract and passes to CounterDisplay</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete smart contract integration:
- Counter contract (counter.clar) with increment/decrement/get-count
- React Query hooks for reading and writing contract state
- CounterDisplay with working increment/decrement buttons
- Transaction status tracking
  </what-built>
  <how-to-verify>
**Prerequisites:**
1. Docker must be running (for Clarinet devnet)
2. Terminal 1: Start devnet
   ```bash
   cd /Users/kenny/Code/stacks-starter/clarity
   clarinet integrate
   ```
   Wait for "Block 3" to appear (contracts deploy in block 2)

3. Terminal 2: Start frontend
   ```bash
   cd /Users/kenny/Code/stacks-starter/front-end
   pnpm dev
   ```

**Test Flow:**
1. Open http://localhost:3000
2. Counter should show "0" (initial value from contract)
3. Connect a devnet wallet (e.g., "wallet_1")
4. Click "Increment" button
   - Should see spinner in button
   - Should see "Transaction pending..." message
   - Toast should appear with "Transaction submitted"
5. Wait 30-60 seconds for block to mine
   - Counter should update to "1"
   - Pending message should clear
6. Click "Increment" again - counter should go to "2"
7. Click "Decrement" - counter should go to "1"
8. Verify "Decrement" button is disabled when counter is "0"

**Expected Results:**
- [ ] Counter value fetches from contract (shows 0 initially)
- [ ] Increment transaction submits successfully
- [ ] Counter updates after block confirmation
- [ ] Decrement transaction works
- [ ] Toast notifications appear for transactions
- [ ] Buttons disabled when wallet not connected
- [ ] Transaction pending state displays correctly
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. `cd /Users/kenny/Code/stacks-starter/front-end && pnpm tsc --noEmit` passes
2. `pnpm build` succeeds
3. Counter value fetches from contract
4. Increment/decrement transactions execute
5. Transaction status tracked until confirmation
</verification>

<success_criteria>
- Counter displays real value from contract
- Increment button submits transaction and updates value
- Decrement button submits transaction and updates value
- Transaction pending state visible to user
- Buttons disabled when appropriate (no wallet, pending tx)
- Error states handled gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/04-smart-contract-integration/04-03-SUMMARY.md`
</output>
