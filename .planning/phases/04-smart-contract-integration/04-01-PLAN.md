---
phase: 04-smart-contract-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - clarity/contracts/counter.clar
  - clarity/Clarinet.toml
  - front-end/src/constants/contracts.ts
autonomous: true

must_haves:
  truths:
    - "Counter contract exists with increment, decrement, get-count functions"
    - "Counter contract registered in Clarinet.toml for devnet deployment"
    - "COUNTER_CONTRACT constant available for frontend use"
  artifacts:
    - path: "clarity/contracts/counter.clar"
      provides: "Counter smart contract with underflow protection"
      contains: "define-data-var counter"
    - path: "clarity/Clarinet.toml"
      provides: "Contract registration for deployment"
      contains: "[contracts.counter]"
    - path: "front-end/src/constants/contracts.ts"
      provides: "Contract address constant"
      exports: ["COUNTER_CONTRACT"]
  key_links:
    - from: "front-end/src/constants/contracts.ts"
      to: "clarity/contracts/counter.clar"
      via: "contract name and deployer address"
      pattern: 'name: "counter"'
---

<objective>
Create the counter smart contract and configure deployment infrastructure.

Purpose: CONT-01 and CONT-02 require a working counter contract that deploys via Clarinet. This plan establishes the contract and the frontend constant needed to interact with it.

Output: counter.clar with increment/decrement/get-count, updated Clarinet.toml, COUNTER_CONTRACT constant
</objective>

<execution_context>
@/Users/kenny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kenny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-smart-contract-integration/04-RESEARCH.md

# Existing patterns
@clarity/Clarinet.toml
@front-end/src/constants/contracts.ts
@front-end/src/lib/devnet-wallet-context.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create counter.clar smart contract</name>
  <files>clarity/contracts/counter.clar</files>
  <action>
Create a simple Clarity counter contract with:

1. Data variable: `(define-data-var counter uint u0)`
2. Error constant: `(define-constant err-underflow (err u1))`
3. Read-only function `get-count`: Returns `(ok (var-get counter))`
4. Public function `increment`: Increments counter by 1, returns new value wrapped in ok
5. Public function `decrement`: Decrements counter by 1 with underflow protection using asserts!

Pattern from RESEARCH.md:
```clarity
(define-data-var counter uint u0)
(define-constant err-underflow (err u1))

(define-read-only (get-count)
  (ok (var-get counter)))

(define-public (increment)
  (begin
    (var-set counter (+ (var-get counter) u1))
    (ok (var-get counter))))

(define-public (decrement)
  (begin
    (asserts! (> (var-get counter) u0) err-underflow)
    (var-set counter (- (var-get counter) u1))
    (ok (var-get counter))))
```

Keep it simple - no access control, no complex logic. This is a starter kit demo.
  </action>
  <verify>Run `cd /Users/kenny/Code/stacks-starter/clarity && clarinet check` - should pass with no errors</verify>
  <done>counter.clar exists with get-count, increment, decrement functions; clarinet check passes</done>
</task>

<task type="auto">
  <name>Task 2: Register counter contract in Clarinet.toml</name>
  <files>clarity/Clarinet.toml</files>
  <action>
Add counter contract configuration to Clarinet.toml after the existing fundraising contract:

```toml
[contracts.counter]
path = 'contracts/counter.clar'
clarity_version = 3
epoch = 3.0
```

Keep existing fundraising contract and requirements - do NOT remove them. The fundraising contract can remain as a reference example.

Note: clarity_version = 3 and epoch = 3.0 match the existing fundraising contract config.
  </action>
  <verify>Run `cd /Users/kenny/Code/stacks-starter/clarity && clarinet check` - should show both contracts checked successfully</verify>
  <done>Clarinet.toml contains [contracts.counter] section with correct path and version</done>
</task>

<task type="auto">
  <name>Task 3: Add COUNTER_CONTRACT constant</name>
  <files>front-end/src/constants/contracts.ts</files>
  <action>
Add COUNTER_CONTRACT constant following the same pattern as FUNDRAISING_CONTRACT:

```typescript
const COUNTER_CONTRACT_NAME = "counter";

// Counter contract uses same deployer as fundraising (deployer wallet on devnet)
export const COUNTER_CONTRACT = {
  address: DEPLOYER_ADDRESS,
  name: COUNTER_CONTRACT_NAME,
} as const;
```

The DEPLOYER_ADDRESS is already defined in the file and handles devnet/testnet/mainnet addresses.

Do NOT modify FUNDRAISING_CONTRACT or SBTC_CONTRACT - keep them for reference.
  </action>
  <verify>TypeScript compiles: `cd /Users/kenny/Code/stacks-starter/front-end && pnpm tsc --noEmit`</verify>
  <done>COUNTER_CONTRACT exported from contracts.ts with address and name properties</done>
</task>

</tasks>

<verification>
1. `cd /Users/kenny/Code/stacks-starter/clarity && clarinet check` passes
2. `cd /Users/kenny/Code/stacks-starter/front-end && pnpm tsc --noEmit` passes
3. counter.clar file exists with all three functions
4. Clarinet.toml has [contracts.counter] section
5. contracts.ts exports COUNTER_CONTRACT
</verification>

<success_criteria>
- Counter contract created with increment, decrement, get-count functions
- Contract registered in Clarinet.toml for deployment
- COUNTER_CONTRACT constant available for frontend hooks
- Both clarinet check and TypeScript compilation pass
</success_criteria>

<output>
After completion, create `.planning/phases/04-smart-contract-integration/04-01-SUMMARY.md`
</output>
