---
phase: 01-foundation-developer-setup
plan: 04
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - front-end/src/components/providers/theme-provider.tsx
  - front-end/src/components/providers/app-providers.tsx
  - front-end/src/components/theme-toggle.tsx
  - front-end/src/app/layout.tsx
  - front-end/package.json
autonomous: true

must_haves:
  truths:
    - "Dark mode toggle works without hydration flash"
    - "Theme persists across page refresh"
    - "System theme preference is respected by default"
    - "`pnpm dev` starts app without Chakra UI errors"
    - "User can click toggle to switch between light/dark modes"
  artifacts:
    - path: "front-end/src/components/providers/theme-provider.tsx"
      provides: "next-themes ThemeProvider wrapper"
      contains: "NextThemesProvider"
    - path: "front-end/src/components/providers/app-providers.tsx"
      provides: "Combined providers for app"
      contains: "ThemeProvider"
    - path: "front-end/src/components/theme-toggle.tsx"
      provides: "Interactive dark mode toggle button"
      contains: "useTheme"
    - path: "front-end/src/app/layout.tsx"
      provides: "Root layout with theme support"
      contains: "suppressHydrationWarning"
  key_links:
    - from: "front-end/src/app/layout.tsx"
      to: "front-end/src/components/providers/app-providers.tsx"
      via: "layout imports and wraps with AppProviders"
      pattern: "AppProviders"
    - from: "front-end/src/components/providers/app-providers.tsx"
      to: "front-end/src/components/providers/theme-provider.tsx"
      via: "AppProviders includes ThemeProvider"
      pattern: "ThemeProvider"
    - from: "front-end/src/components/theme-toggle.tsx"
      to: "next-themes"
      via: "useTheme hook for theme switching"
      pattern: "useTheme"
---

<objective>
Implement dark mode using next-themes without hydration flash, create an interactive theme toggle component, and remove Chakra UI dependencies to complete the UI foundation migration.

Purpose: Dark mode is a user expectation for modern apps. next-themes handles the complexity of SSR hydration, system theme detection, and localStorage persistence. The theme toggle gives developers an immediate way to test dark mode. Removing Chakra UI eliminates the old UI framework since we now have Tailwind + shadcn as the foundation. This plan completes the FOUN-04 requirement and prepares for DEVX-05 (working pnpm dev).

Output: Working dark mode with ThemeProvider, interactive toggle component, Chakra UI removed, clean app providers structure.
</objective>

<execution_context>
@/Users/kenny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kenny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-developer-setup/01-RESEARCH.md

# Reference implementation patterns from research
# Pattern 3: Dark Mode Implementation (No Hydration Flash)

# Files that will be modified/referenced
@front-end/src/app/layout.tsx
@front-end/src/components/ui/Providers.tsx
@front-end/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install next-themes and create ThemeProvider</name>
  <files>
    front-end/package.json (add dependency)
    front-end/src/components/providers/theme-provider.tsx (create)
  </files>
  <action>
    1. Navigate to front-end directory
    2. Install next-themes:
       ```bash
       pnpm add next-themes
       ```

    3. Create providers directory:
       ```bash
       mkdir -p src/components/providers
       ```

    4. Create theme-provider.tsx as a Client Component:
       ```typescript
       "use client"

       import * as React from "react"
       import { ThemeProvider as NextThemesProvider } from "next-themes"

       export function ThemeProvider({
         children,
         ...props
       }: React.ComponentProps<typeof NextThemesProvider>) {
         return <NextThemesProvider {...props}>{children}</NextThemesProvider>
       }
       ```

       This wrapper enables us to use next-themes in the App Router while keeping the "use client" directive isolated.
  </action>
  <verify>
    Run: `cat /Users/kenny/Code/stacks-starter/front-end/src/components/providers/theme-provider.tsx`
    Expected: File exists with "use client" and NextThemesProvider

    Run: `grep "next-themes" /Users/kenny/Code/stacks-starter/front-end/package.json`
    Expected: next-themes in dependencies
  </verify>
  <done>next-themes installed, ThemeProvider component created</done>
</task>

<task type="auto">
  <name>Task 2: Create AppProviders and remove Chakra UI</name>
  <files>
    front-end/src/components/providers/app-providers.tsx (create)
    front-end/src/components/ui/Providers.tsx (delete or repurpose)
    front-end/package.json (remove Chakra dependencies)
    front-end/src/theme.ts (delete)
  </files>
  <action>
    1. Create new app-providers.tsx that combines providers WITHOUT Chakra and WITHOUT wallet providers (wallet providers will be added in Phase 3):
       ```typescript
       "use client"

       import { QueryClient, QueryClientProvider } from "@tanstack/react-query"
       import { ThemeProvider } from "./theme-provider"

       // TODO: Add wallet providers in Phase 3:
       // import { HiroWalletProvider } from "../HiroWalletProvider"
       // import { DevnetWalletProvider } from "../DevnetWalletProvider"

       const queryClient = new QueryClient()

       export function AppProviders({ children }: { children: React.ReactNode }) {
         return (
           <QueryClientProvider client={queryClient}>
             <ThemeProvider
               attribute="class"
               defaultTheme="system"
               enableSystem
               disableTransitionOnChange
             >
               {children}
             </ThemeProvider>
           </QueryClientProvider>
         )
       }
       ```

       Provider order:
       - QueryClientProvider: outermost (data layer)
       - ThemeProvider: wraps content (theming)
       - Children: innermost

       NOTE: HiroWalletProvider and DevnetWalletProvider do not exist yet. They will be created in Phase 3 (Wallet Integration). Do NOT import them here - this would cause build failures.

    2. Delete the old Providers.tsx file (src/components/ui/Providers.tsx) - it uses Chakra

    3. Delete src/theme.ts (Chakra theme file)

    4. Remove Chakra UI dependencies from package.json:
       ```bash
       pnpm remove @chakra-ui/react @chakra-ui/icons
       ```

    5. Check for any remaining Chakra imports in the codebase and note them for the verification step. Components that use Chakra will break temporarily - that's expected since Phase 2 will rebuild them with shadcn.

    Note: Some existing components (Navbar, etc.) may have Chakra imports. For now, we're establishing the foundation. Those components will be updated in Phase 2 (UI Component Library).
  </action>
  <verify>
    Run: `grep -r "@chakra-ui" /Users/kenny/Code/stacks-starter/front-end/src/components/providers/ || echo "No Chakra in providers"`
    Expected: "No Chakra in providers"

    Run: `grep "@chakra-ui" /Users/kenny/Code/stacks-starter/front-end/package.json || echo "Chakra removed"`
    Expected: "Chakra removed"

    Run: `cat /Users/kenny/Code/stacks-starter/front-end/src/components/providers/app-providers.tsx | grep ThemeProvider`
    Expected: Shows ThemeProvider import and usage

    Run: `grep -E "HiroWalletProvider|DevnetWalletProvider" /Users/kenny/Code/stacks-starter/front-end/src/components/providers/app-providers.tsx || echo "No wallet provider imports (correct)"`
    Expected: "No wallet provider imports (correct)"
  </verify>
  <done>AppProviders created with QueryClientProvider + ThemeProvider only, Chakra UI removed from dependencies</done>
</task>

<task type="auto">
  <name>Task 3: Update root layout for dark mode</name>
  <files>
    front-end/src/app/layout.tsx (modify)
  </files>
  <action>
    1. Update layout.tsx to use new AppProviders and add suppressHydrationWarning:
       ```typescript
       import type { Metadata } from "next";
       import { Geist, Geist_Mono } from "next/font/google";
       import "./globals.css";
       import { AppProviders } from "@/components/providers/app-providers";

       const geistSans = Geist({
         variable: "--font-geist-sans",
         subsets: ["latin"],
       });

       const geistMono = Geist_Mono({
         variable: "--font-geist-mono",
         subsets: ["latin"],
       });

       export const metadata: Metadata = {
         title: "Stacks Starter",
         description: "A developer-friendly starter kit for building on Stacks",
       };

       export default function RootLayout({
         children,
       }: Readonly<{
         children: React.ReactNode;
       }>) {
         return (
           <html lang="en" suppressHydrationWarning>
             <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
               <AppProviders>
                 {children}
               </AppProviders>
             </body>
           </html>
         );
       }
       ```

       CRITICAL changes:
       - Added `suppressHydrationWarning` to <html> - prevents React hydration warnings from theme detection
       - Removed Navbar import (has Chakra dependencies - will be rebuilt in Phase 2)
       - Changed Providers to AppProviders
       - Updated metadata for starter kit branding
       - Added `antialiased` class for better font rendering

    2. For now, remove the Navbar from layout since it depends on Chakra. Phase 2 will rebuild the Navbar with shadcn.

    3. Verify the app starts without Chakra errors:
       ```bash
       pnpm dev
       ```
       The page may look unstyled/broken - that's expected since we removed Chakra but haven't built new components yet. The important thing is no runtime errors.

    4. Test dark mode works by adding dark class manually:
       - In browser dev tools, add class="dark" to <html>
       - Background should change if CSS variables are set up correctly
  </action>
  <verify>
    Run: `grep "suppressHydrationWarning" /Users/kenny/Code/stacks-starter/front-end/src/app/layout.tsx`
    Expected: <html lang="en" suppressHydrationWarning>

    Run: `grep "AppProviders" /Users/kenny/Code/stacks-starter/front-end/src/app/layout.tsx`
    Expected: Import and usage of AppProviders

    Run: `cd /Users/kenny/Code/stacks-starter/front-end && pnpm build`
    Expected: Build succeeds (may have warnings about unused imports in other files - OK for now)
  </verify>
  <done>Root layout updated with suppressHydrationWarning, uses AppProviders, builds successfully</done>
</task>

<task type="auto">
  <name>Task 4: Create theme toggle component</name>
  <files>
    front-end/src/components/theme-toggle.tsx (create)
    front-end/src/app/page.tsx (modify to include toggle)
  </files>
  <action>
    1. Create theme-toggle.tsx as a Client Component using next-themes useTheme hook:
       ```typescript
       "use client"

       import * as React from "react"
       import { Moon, Sun } from "lucide-react"
       import { useTheme } from "next-themes"

       export function ThemeToggle() {
         const { theme, setTheme } = useTheme()
         const [mounted, setMounted] = React.useState(false)

         // Avoid hydration mismatch by only rendering after mount
         React.useEffect(() => {
           setMounted(true)
         }, [])

         if (!mounted) {
           // Return placeholder with same dimensions to avoid layout shift
           return (
             <button
               className="inline-flex h-10 w-10 items-center justify-center rounded-md border border-input bg-background"
               aria-label="Toggle theme"
             >
               <span className="h-5 w-5" />
             </button>
           )
         }

         return (
           <button
             onClick={() => setTheme(theme === "dark" ? "light" : "dark")}
             className="inline-flex h-10 w-10 items-center justify-center rounded-md border border-input bg-background hover:bg-accent hover:text-accent-foreground transition-colors"
             aria-label="Toggle theme"
           >
             {theme === "dark" ? (
               <Sun className="h-5 w-5" />
             ) : (
               <Moon className="h-5 w-5" />
             )}
           </button>
         )
       }
       ```

       Key implementation details:
       - Uses mounted state to avoid hydration mismatch (server doesn't know theme)
       - Placeholder button prevents layout shift during hydration
       - Uses Tailwind classes for styling (no shadcn Button needed yet)
       - Uses lucide-react icons (already installed in 01-02)
       - Simple toggle between dark and light (system preference handled by next-themes)

    2. Add the theme toggle to the main page so developers can test it:
       Update src/app/page.tsx to include the ThemeToggle component in a visible location:
       ```typescript
       import { ThemeToggle } from "@/components/theme-toggle"

       export default function Home() {
         return (
           <main className="min-h-screen p-8">
             <div className="flex justify-end mb-8">
               <ThemeToggle />
             </div>
             <h1 className="text-4xl font-bold">Stacks Starter</h1>
             <p className="mt-4 text-muted-foreground">
               Developer-friendly starter kit for building on Stacks
             </p>
           </main>
         )
       }
       ```

    3. Test the toggle works:
       - Run `pnpm dev`
       - Click the toggle button
       - Observe theme change (background, text colors should switch)
       - Refresh page - theme should persist
  </action>
  <verify>
    Run: `cat /Users/kenny/Code/stacks-starter/front-end/src/components/theme-toggle.tsx | grep -E "useTheme|setTheme"`
    Expected: Shows useTheme import and setTheme usage

    Run: `grep "ThemeToggle" /Users/kenny/Code/stacks-starter/front-end/src/app/page.tsx`
    Expected: ThemeToggle imported and used in page

    Run: `cd /Users/kenny/Code/stacks-starter/front-end && pnpm build`
    Expected: Build succeeds with theme toggle component

    Visual verification (manual step):
    1. Run `pnpm dev` in front-end directory
    2. Open http://localhost:3000 in browser
    3. Click the theme toggle button (sun/moon icon in top right)
    4. Confirm theme switches between light and dark
    5. Refresh page - theme should persist
  </verify>
  <done>Theme toggle component created and integrated into main page, users can interactively switch themes</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Theme provider exists:
   ```bash
   cat front-end/src/components/providers/theme-provider.tsx | head -10
   # Expected: "use client" and NextThemesProvider
   ```

2. No Chakra in dependencies:
   ```bash
   grep "@chakra-ui" front-end/package.json || echo "Chakra removed successfully"
   # Expected: "Chakra removed successfully"
   ```

3. Layout has hydration fix:
   ```bash
   grep "suppressHydrationWarning" front-end/src/app/layout.tsx
   # Expected: suppressHydrationWarning present
   ```

4. Theme toggle exists:
   ```bash
   cat front-end/src/components/theme-toggle.tsx | grep "useTheme"
   # Expected: useTheme hook used
   ```

5. App builds without errors:
   ```bash
   cd front-end && pnpm build
   # Expected: Build succeeds
   ```

6. Dev server starts:
   ```bash
   cd front-end && timeout 10 pnpm dev || true
   # Expected: Server starts (page may be unstyled - OK)
   ```
</verification>

<success_criteria>
- next-themes installed and ThemeProvider created
- suppressHydrationWarning on <html> element (prevents hydration flash)
- ThemeProvider configured with attribute="class", defaultTheme="system", enableSystem
- Theme toggle component created with useTheme hook
- Theme toggle added to main page for developer testing
- Chakra UI dependencies removed from package.json
- Old Providers.tsx and theme.ts deleted
- AppProviders combines QueryClient + ThemeProvider (NO wallet providers yet)
- Root layout uses AppProviders
- `pnpm dev` starts without Chakra-related errors
- `pnpm build` succeeds
- FOUN-04 (dark mode without hydration flash) complete
- DEVX-05 (working pnpm dev) complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-developer-setup/01-04-SUMMARY.md`
</output>
