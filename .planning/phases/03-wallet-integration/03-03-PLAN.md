---
phase: 03-wallet-integration
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - front-end/src/components/navbar.tsx
  - front-end/src/app/page.tsx
autonomous: false

must_haves:
  truths:
    - "Navbar shows Connect Wallet / wallet selector when disconnected"
    - "Navbar shows truncated address dropdown when connected"
    - "Developer on devnet can select wallet and see address in navbar"
    - "Developer can click disconnect and see Connect Wallet button return"
    - "Network indicator updates based on wallet context (if applicable)"
  artifacts:
    - path: "front-end/src/components/navbar.tsx"
      provides: "Navbar with wallet integration"
      contains: ["ConnectButton", "WalletDropdown", "useWallet"]
      min_lines: 20
  key_links:
    - from: "navbar.tsx"
      to: "wallet-provider.tsx"
      via: "useWallet hook"
      pattern: "useWallet"
    - from: "navbar.tsx"
      to: "connect-button.tsx"
      via: "ConnectButton import"
      pattern: "ConnectButton"
    - from: "navbar.tsx"
      to: "wallet-dropdown.tsx"
      via: "WalletDropdown import"
      pattern: "WalletDropdown"
---

<objective>
Integrate wallet components into Navbar and verify the complete wallet connection flow.

Purpose: Complete the wallet integration by connecting UI components to the page and verifying the user experience end-to-end.

Output: Working wallet connection in Navbar with visual verification.
</objective>

<execution_context>
@/Users/kenny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kenny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-wallet-integration/03-RESEARCH.md
@.planning/phases/03-wallet-integration/03-CONTEXT.md
@.planning/phases/03-wallet-integration/03-01-SUMMARY.md
@.planning/phases/03-wallet-integration/03-02-SUMMARY.md

# Files to modify
@front-end/src/components/navbar.tsx
@front-end/src/app/page.tsx

# Wallet components
@front-end/src/components/wallet/connect-button.tsx
@front-end/src/components/wallet/wallet-dropdown.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Navbar with wallet components</name>
  <files>front-end/src/components/navbar.tsx</files>
  <action>
Replace placeholder Connect Wallet button with actual wallet components.

**Requirements:**

1. Keep "use client" directive (already present)

2. Import new dependencies:
   - useWallet from @/components/providers/wallet-provider
   - ConnectButton from @/components/wallet/connect-button
   - WalletDropdown from @/components/wallet/wallet-dropdown

3. Update component to conditionally render:
```tsx
export function Navbar() {
  const { isConnected } = useWallet()

  return (
    <nav className="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="container flex h-14 items-center justify-between">
        <div className="font-semibold">Stacks Starter</div>
        <div className="flex items-center gap-2">
          <ThemeToggle />
          {isConnected ? <WalletDropdown /> : <ConnectButton />}
        </div>
      </div>
    </nav>
  )
}
```

4. Remove the old placeholder Button import if no longer needed (check if Button used elsewhere)
  </action>
  <verify>
```bash
cd front-end && pnpm tsc --noEmit && pnpm build
```
Build succeeds without errors.
  </verify>
  <done>
Navbar imports useWallet, ConnectButton, WalletDropdown. Shows ConnectButton when disconnected, WalletDropdown when connected. Build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update NetworkIndicator to use wallet context</name>
  <files>front-end/src/app/page.tsx</files>
  <action>
Update the main page to get network from wallet context instead of hardcoded value.

**Requirements:**

1. The page is currently a Server Component. Since we need useWallet, we have two options:
   - Option A: Make page a client component (simpler)
   - Option B: Create a small client wrapper component (better architecture)

**Recommended: Option B - Create NetworkDisplay client component inline or separate**

Actually, looking at the current page structure, the simplest approach is:

1. Create a small client component `NetworkDisplay` that uses useWallet:
```tsx
"use client"
import { NetworkIndicator } from "@/components/network-indicator"
import { useWallet } from "@/components/providers/wallet-provider"

export function NetworkDisplay() {
  const { network } = useWallet()
  return (
    <div className="flex items-center gap-2">
      <span className="text-sm text-muted-foreground">Network:</span>
      <NetworkIndicator network={network} />
    </div>
  )
}
```

2. Add this to page.tsx as an inline component OR import from a new file

3. Replace the hardcoded network display with the dynamic one

**Alternative (simpler):** If we want to keep page simple, just add "use client" to page.tsx and use useWallet directly. Given this is a starter kit with simple architecture, this is acceptable.

**Choose the simpler approach:** Add "use client" to page.tsx and use useWallet for network.

```tsx
"use client"

import { Navbar } from "@/components/navbar"
import { CounterDisplay } from "@/components/counter-display"
import { NetworkIndicator } from "@/components/network-indicator"
import { useWallet } from "@/components/providers/wallet-provider"

export default function Home() {
  const { network } = useWallet()

  return (
    <div className="min-h-screen bg-background">
      <Navbar />
      <main className="container py-8">
        <div className="flex flex-col items-center gap-6">
          <div className="flex items-center gap-2">
            <span className="text-sm text-muted-foreground">Network:</span>
            <NetworkIndicator network={network} />
          </div>
          <CounterDisplay value={0} />
        </div>
      </main>
    </div>
  )
}
```
  </action>
  <verify>
```bash
cd front-end && pnpm build
```
Build succeeds. Network indicator will show network from context.
  </verify>
  <done>
Page uses useWallet to get network. NetworkIndicator displays dynamic network value from wallet context. Build succeeds.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete wallet integration:
- WalletProvider context with Leather and devnet support
- DevnetWalletSelector showing 6 test wallets
- ConnectButton (network-aware: devnet selector vs Leather button)
- WalletDropdown with truncated address, copy, disconnect
- Navbar integration showing appropriate wallet state
- Dynamic network indicator from wallet context
  </what-built>
  <how-to-verify>
Start dev server and test wallet flows:

```bash
cd front-end && pnpm dev
```

Then open http://localhost:3000 and verify:

**Devnet Flow (default):**
1. Page loads with "Select Wallet" dropdown in navbar
2. Network indicator shows "Devnet"
3. Click "Select Wallet" - should see 6 wallets: Deployer, Wallet 1-5
4. Select "Deployer" - should see truncated address (ST1PQH...ZGZGM)
5. Click the address dropdown - should see:
   - Full address with copy option
   - Disconnect option
6. Click "Copy" - should see toast "Address copied to clipboard"
7. Click "Disconnect" - should return to "Select Wallet" button

**Visual checks:**
- Dark mode toggle still works
- Dropdown menus align properly (right-aligned)
- Truncated addresses are readable
- Theme consistent across all wallet components

**Optional (if Leather installed):**
- Set NEXT_PUBLIC_NETWORK=testnet in .env.local
- Restart dev server
- Click "Connect Wallet" - should trigger Leather extension prompt
  </how-to-verify>
  <resume-signal>Type "approved" if wallet integration works, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Phase 3 Success Criteria:
1. Developer clicks "Connect Wallet" and sees Leather extension prompt (testnet/mainnet)
2. Developer on devnet sees wallet selector with 6 test wallets
3. Developer selects wallet and sees address displayed in navbar
4. Wallet context provides current address, network, and connection state to child components
5. Developer clicks "Disconnect" and wallet connection clears
</verification>

<success_criteria>
- Navbar shows ConnectButton when disconnected
- Navbar shows WalletDropdown when connected
- Devnet wallet selector shows 6 wallets
- Selected wallet address appears truncated in navbar
- Copy address works with toast feedback
- Disconnect clears wallet state
- Network indicator reflects wallet context network
- All requirements WALL-01 through WALL-04 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/03-wallet-integration/03-03-SUMMARY.md`
</output>
