---
phase: 05-documentation-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/patterns.md
  - docs/extending.md
autonomous: true

must_haves:
  truths:
    - "Developer reads docs/patterns.md and understands wallet integration, contract interaction, and React Query patterns"
    - "Developer reads docs/extending.md and knows how to add new contract functions or replace counter with their own contract"
    - "Documentation explains what code is scaffolding (keep), examples (delete after learning), and developer code (modify)"
  artifacts:
    - path: "docs/patterns.md"
      provides: "Architecture patterns documentation"
      contains: "Wallet Integration"
    - path: "docs/extending.md"
      provides: "Extension and deletion guidance"
      contains: "Delete"
  key_links:
    - from: "docs/patterns.md"
      to: "front-end/src/components/providers/wallet-provider.tsx"
      via: "markdown link"
      pattern: "wallet-provider"
    - from: "docs/patterns.md"
      to: "front-end/src/hooks/counterQueries.ts"
      via: "markdown link"
      pattern: "counterQueries"
    - from: "docs/extending.md"
      to: "docs/patterns.md"
      via: "markdown link"
      pattern: "patterns"
---

<objective>
Create docs/patterns.md and docs/extending.md - the deep-dive documentation for understanding and extending the starter kit.

Purpose: After setup, developers need to understand the architecture (patterns.md) and know how to replace the example code with their own (extending.md).

Output: New docs/patterns.md and docs/extending.md
</objective>

<execution_context>
@/Users/kenny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kenny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-documentation-polish/05-CONTEXT.md
@.planning/phases/05-documentation-polish/05-RESEARCH.md

# Key source files to reference in documentation (link to, don't inline)
@front-end/src/components/providers/wallet-provider.tsx
@front-end/src/components/providers/app-providers.tsx
@front-end/src/hooks/counterQueries.ts
@front-end/src/constants/contracts.ts
@front-end/src/components/wallet/connect-button.tsx
@front-end/src/components/wallet/devnet-wallet-selector.tsx
@front-end/src/components/counter-display.tsx
@clarity/contracts/counter.clar
@clarity/deployments/default.devnet-plan.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docs/patterns.md</name>
  <files>docs/patterns.md</files>
  <action>
Create architecture patterns documentation following the concept-focused pattern from RESEARCH.md.

**Structure:**

## Overview
Brief intro: This doc explains the recurring patterns in this starter kit. Understand these and you can build any Stacks dApp.

## Wallet Integration Pattern

**Context:** Stacks dApps need wallet connection for transaction signing.

**The Pattern:**
- Devnet: WalletProvider auto-connects with pre-funded test wallets (no browser extension needed)
- Testnet/Mainnet: Leather wallet extension handles connection and signing

**Implementation:**
Link to front-end/src/components/providers/wallet-provider.tsx

**Network Detection:**
- NEXT_PUBLIC_NETWORK env var controls network
- Devnet shows wallet selector, other networks show Leather connect button
- Link to front-end/src/components/wallet/connect-button.tsx

**When to use which:**
- Devnet: Fast iteration during development
- Testnet: Test with real wallet extension before mainnet
- Mainnet: Production

## Contract Read Pattern (Queries)

**Context:** Reading contract state without signing transactions.

**The Pattern:**
- Use React Query's useQuery for read-only contract calls
- cvToValue converts Clarity values to JavaScript
- Automatic refetching, caching, error handling

**Implementation:**
Link to front-end/src/hooks/counterQueries.ts - see useCounterValue

**Key concepts:**
- callReadOnlyFunction from @stacks/transactions
- Contract address and name from constants
- Principal caller (doesn't need to be connected wallet for reads)

## Contract Write Pattern (Mutations)

**Context:** Executing contract functions that change state.

**The Pattern:**
- Use React Query's useMutation for state-changing calls
- openContractCall prompts wallet to sign
- Devnet auto-signs, Leather prompts user
- Invalidate queries after successful mutation to refetch updated state

**Implementation:**
Link to front-end/src/hooks/counterQueries.ts - see useIncrementCounter, useDecrementCounter

**Key concepts:**
- openContractCall from @stacks/connect
- Transaction options: contractAddress, contractName, functionName, functionArgs
- onFinish callback to handle transaction submission
- Query invalidation pattern

## React Query Integration

**Context:** Managing async state (loading, error, data) for contract interactions.

**The Pattern:**
- QueryClientProvider at app root
- useQuery for reads (GET-like operations)
- useMutation for writes (POST-like operations)
- queryClient.invalidateQueries to refetch after mutations

**Implementation:**
Link to front-end/src/components/providers/app-providers.tsx for QueryClient setup

**Why React Query:**
- Automatic caching reduces redundant API calls
- Built-in loading/error states
- Optimistic updates possible
- Stale-while-revalidate pattern

## Transaction Status Pattern

**Context:** Users need feedback while transactions are pending.

**The Pattern:**
- Track pendingTxId in component state
- Show pending UI while transaction confirms
- Clear pending state on success
- React Query handles refetch timing

**Implementation:**
Link to front-end/src/components/counter-display.tsx - see pending state handling

**Constraints from CONTEXT.md:**
- Link to source files, don't inline code
- Concise/technical tone
- Explain "why" and "when", not just "what"
  </action>
  <verify>
1. File exists at docs/patterns.md
2. Contains sections for Wallet Integration, Contract Read, Contract Write, React Query
3. Each section links to source files
4. No inline code snippets (links only)
5. Explains when to use each pattern
  </verify>
  <done>patterns.md exists with Wallet Integration, Contract Read (Query), Contract Write (Mutation), React Query Integration, and Transaction Status patterns - each linking to source files</done>
</task>

<task type="auto">
  <name>Task 2: Create docs/extending.md</name>
  <files>docs/extending.md</files>
  <action>
Create extension and deletion guidance following the deletion guidance pattern from RESEARCH.md.

**Structure:**

## Overview
Brief intro: The counter is example code. This doc explains what to keep, what to delete, and how to add your own contract.

## What's What

**Scaffolding (KEEP)** - Powers any contract interaction:
- front-end/src/components/providers/ - Wallet and React Query setup
- front-end/src/lib/ - Utility functions
- front-end/src/components/ui/ - shadcn components
- front-end/src/components/navbar.tsx - Navigation shell
- front-end/src/components/theme-toggle.tsx - Dark mode

**Example Code (DELETE)** - Counter demonstration:
- clarity/contracts/counter.clar - Example contract
- front-end/src/hooks/counterQueries.ts - Example queries/mutations
- front-end/src/components/counter-display.tsx - Example UI
- clarity/contracts/fundraising.clar - Legacy example (can delete)

**Configuration (MODIFY)** - Point to your contract:
- front-end/src/constants/contracts.ts - Contract addresses
- clarity/deployments/default.devnet-plan.yaml - Deployment plan
- front-end/.env - API keys

## Delete the Example

Explicit deletion commands:
```bash
rm clarity/contracts/counter.clar
rm clarity/contracts/fundraising.clar
rm front-end/src/hooks/counterQueries.ts
rm front-end/src/components/counter-display.tsx
rm -rf front-end/src/components/_deprecated-chakra
```

Update front-end/src/app/page.tsx to remove CounterDisplay import and usage.

## Add Your Contract

Step-by-step:
1. Write your contract in clarity/contracts/your-contract.clar
2. Add contract to clarity/Clarinet.toml
3. Update clarity/deployments/default.devnet-plan.yaml to deploy your contract
4. Update front-end/src/constants/contracts.ts with your contract name and address pattern
5. Create front-end/src/hooks/yourContractQueries.ts following the pattern (link to patterns.md#contract-read-pattern)
6. Create UI components that use your queries/mutations

## Add a New Contract Function

Walkthrough for adding a function to existing contract:
1. Add function to .clar file (example: read-only vs public)
2. Restart Devnet (changes require redeploy)
3. Add query (for read-only) or mutation (for public) to hooks file
4. Wire up UI

**Link to patterns.md sections** for each step.

## Moving to Testnet/Mainnet

Brief guidance:
1. Deploy contract to testnet via Hiro Platform
2. Update NEXT_PUBLIC_NETWORK to testnet
3. Update contract deployer addresses in constants
4. Test with Leather wallet (no more auto-signing)
5. When ready for mainnet, repeat with mainnet config

**Constraints from CONTEXT.md:**
- Link to source files, don't inline code
- Explicit "delete the example" section
- Concise/technical tone
  </action>
  <verify>
1. File exists at docs/extending.md
2. Contains "What's What" section with keep/delete/modify categories
3. Contains explicit "Delete the Example" section with commands
4. Contains "Add Your Contract" step-by-step
5. Links to patterns.md for deeper concepts
  </verify>
  <done>extending.md exists with scaffolding/example/config categorization, explicit deletion commands, step-by-step for adding new contracts, and testnet/mainnet guidance</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. docs/patterns.md explains all major architectural patterns
2. docs/extending.md provides clear keep/delete/modify guidance
3. A developer could replace counter with their own contract following extending.md
4. All docs link to source files rather than inlining code
</verification>

<success_criteria>
- patterns.md covers: wallet integration, contract reads, contract writes, React Query, transaction status
- extending.md covers: what to keep/delete/modify, explicit deletion commands, add-your-contract walkthrough
- Both files link to source code rather than inline snippets
- Documentation explains scaffolding vs example code distinction
</success_criteria>

<output>
After completion, create `.planning/phases/05-documentation-polish/05-02-SUMMARY.md`
</output>
