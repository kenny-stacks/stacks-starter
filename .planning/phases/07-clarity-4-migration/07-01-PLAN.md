---
phase: 07-clarity-4-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - clarity/Clarinet.toml
autonomous: true

must_haves:
  truths:
    - "Clarinet.toml specifies clarity_version = 4 for counter contract"
    - "Clarinet.toml specifies clarity_version = 4 for fundraising contract"
    - "Clarinet.toml specifies epoch = 3.3 for both contracts"
    - "clarinet check passes without errors"
    - "clarinet test passes (existing tests remain valid)"
  artifacts:
    - path: "clarity/Clarinet.toml"
      provides: "Clarity 4 configuration for all contracts"
      contains: "clarity_version = 4"
  key_links:
    - from: "clarity/Clarinet.toml"
      to: "clarinet check"
      via: "configuration validation"
      pattern: "clarity_version = 4"
---

<objective>
Update Clarinet.toml to enable Clarity 4 for all contracts and verify tooling compatibility.

Purpose: This is the core configuration change for the Clarity 4 migration. Clarity 4 is fully backward compatible with Clarity 3, so existing contracts will work unchanged after the configuration update.

Output: Updated Clarinet.toml with clarity_version = 4 and epoch = 3.3 for both contracts, verified working with Clarinet tooling.
</objective>

<execution_context>
@/Users/kenny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kenny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-clarity-4-migration/07-RESEARCH.md
@clarity/Clarinet.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Clarinet.toml for Clarity 4</name>
  <files>clarity/Clarinet.toml</files>
  <action>
Update both contract entries in Clarinet.toml to use Clarity 4:

For [contracts.counter]:
- Change `clarity_version = 3` to `clarity_version = 4`
- Change `epoch = 3.0` to `epoch = 3.3`

For [contracts.fundraising]:
- Change `clarity_version = 3` to `clarity_version = 4`
- Change `epoch = 3.0` to `epoch = 3.3`

Keep all other configuration unchanged (project settings, requirements, repl.analysis).

Note: Use unquoted values (epoch = 3.3 not epoch = "3.3") to match existing pattern.
  </action>
  <verify>
1. Read Clarinet.toml and confirm both contracts show clarity_version = 4
2. Read Clarinet.toml and confirm both contracts show epoch = 3.3
  </verify>
  <done>
Clarinet.toml has clarity_version = 4 and epoch = 3.3 for both counter and fundraising contracts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify Clarinet tooling with Clarity 4 configuration</name>
  <files>clarity/Clarinet.toml</files>
  <action>
Run Clarinet tooling to verify the configuration is valid:

1. Run `clarinet check` in the clarity directory
   - Should pass with no errors
   - Confirms syntax/configuration valid for Clarity 4

2. Run `clarinet test` in the clarity directory
   - Should pass all existing tests (fundraising.test.ts)
   - Confirms backward compatibility maintained

If either command fails:
- Check error message for epoch/version syntax issues
- Try quoted epoch value (epoch = "3.3") if unquoted fails
- Document any issues encountered
  </action>
  <verify>
1. `cd clarity && clarinet check` exits with code 0
2. `cd clarity && clarinet test` exits with code 0 and all tests pass
  </verify>
  <done>
Both `clarinet check` and `clarinet test` pass with Clarity 4 configuration.
  </done>
</task>

</tasks>

<verification>
Run the following to verify Phase 7 Plan 01 completion:

```bash
cd clarity

# 1. Verify configuration
grep -A2 'contracts.counter' Clarinet.toml | grep 'clarity_version = 4'
grep -A2 'contracts.counter' Clarinet.toml | grep 'epoch = 3.3'
grep -A2 'contracts.fundraising' Clarinet.toml | grep 'clarity_version = 4'
grep -A2 'contracts.fundraising' Clarinet.toml | grep 'epoch = 3.3'

# 2. Verify tooling
clarinet check
clarinet test
```

All commands should succeed with exit code 0.
</verification>

<success_criteria>
1. Clarinet.toml has clarity_version = 4 for both contracts
2. Clarinet.toml has epoch = 3.3 for both contracts
3. `clarinet check` passes
4. `clarinet test` passes with all existing tests
</success_criteria>

<output>
After completion, create `.planning/phases/07-clarity-4-migration/07-01-SUMMARY.md`
</output>
