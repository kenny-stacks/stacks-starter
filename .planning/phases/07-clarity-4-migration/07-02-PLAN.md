---
phase: 07-clarity-4-migration
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Counter contract has been reviewed for Clarity 4 idiom improvements"
    - "Assessment documents which Clarity 4 features were considered"
    - "Assessment documents decision to adopt or defer each feature"
    - "Contract behavior is verified identical to Clarity 3 version"
  artifacts:
    - path: ".planning/phases/07-clarity-4-migration/07-02-SUMMARY.md"
      provides: "Contract idiom assessment documentation"
      contains: "Clarity 4 idioms considered"
  key_links:
    - from: "clarity/contracts/counter.clar"
      to: "assessment decision"
      via: "code review"
      pattern: "No code changes"
---

<objective>
Review the counter contract for Clarity 4 idiom improvements and document the assessment.

Purpose: Per requirements CTR-01 and CTR-02, we must review the contract for potential Clarity 4 improvements. The user explicitly chose "minimal update, config only" in REQUIREMENTS.md (stacks-block-time deferred), so this task documents the assessment decision rather than implementing changes.

Output: Documented assessment of Clarity 4 idioms for the counter contract, verification that contract behavior is unchanged.
</objective>

<execution_context>
@/Users/kenny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kenny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-clarity-4-migration/07-RESEARCH.md
@.planning/phases/07-clarity-4-migration/07-01-SUMMARY.md
@clarity/contracts/counter.clar
</context>

<tasks>

<task type="auto">
  <name>Task 1: Review counter contract for Clarity 4 idioms</name>
  <files>clarity/contracts/counter.clar</files>
  <action>
Review the counter contract (17 lines) against Clarity 4 features from research:

**Clarity 4 features to evaluate:**
1. `stacks-block-time` - Real timestamps instead of block heights
2. `contract-hash?` - On-chain contract verification
3. `restrict-assets?` - Contract-level asset protection
4. `secp256r1-verify` - WebAuthn/passkey support

**For each feature, document:**
- Whether the counter contract could use it
- Whether it provides clear benefit for a simple counter
- Decision: adopt or defer

**Expected findings (from research):**
- The counter contract is minimal (17 lines: data-var, error constant, 3 functions)
- None of the Clarity 4 features provide clear benefit for a basic counter
- `stacks-block-time` could track last-update but was explicitly deferred by user
- No time-based logic, no verification needs, no asset protection needs, no signature needs

Document findings for the summary.
  </action>
  <verify>
Assessment documents all 4 Clarity 4 features and provides clear rationale for each decision.
  </verify>
  <done>
Counter contract has been reviewed. Assessment shows no Clarity 4 idioms provide clear benefit for this minimal counter contract. User's decision to use config-only approach is validated.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify contract behavior unchanged</name>
  <files>clarity/contracts/counter.clar</files>
  <action>
Verify the counter contract behavior is identical after Clarity 4 migration:

1. Start devnet (if not running): `clarinet devnet start` or use existing
2. Deploy and test counter contract manually via clarinet console, OR
3. Run `clarinet test` to confirm all tests pass (already done in 07-01, but verify again)

**Expected behavior to verify:**
- `get-count` returns (ok u0) initially
- `increment` increases counter and returns new value
- `decrement` decreases counter and returns new value
- `decrement` on u0 returns (err u1) for underflow

Since no code changes were made (config-only migration), behavior should be identical.
  </action>
  <verify>
Run `cd clarity && clarinet test` - all tests pass confirming behavior unchanged.
  </verify>
  <done>
Contract behavior verified identical to Clarity 3 version. All tests pass. Backward compatibility confirmed.
  </done>
</task>

</tasks>

<verification>
Phase 7 Plan 02 verification:

1. Summary includes assessment of all 4 Clarity 4 features
2. Summary documents rationale for no code changes
3. `clarinet test` passes confirming unchanged behavior
</verification>

<success_criteria>
1. Assessment documents consideration of: stacks-block-time, contract-hash?, restrict-assets?, secp256r1-verify
2. Assessment provides clear rationale for deferring each feature
3. Contract tests pass confirming backward compatibility
4. Requirements CTR-01 (review) and CTR-02 (apply beneficial changes) are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/07-clarity-4-migration/07-02-SUMMARY.md`

The summary should include:
- Clarity 4 idiom assessment table
- Decision rationale for each feature
- Verification that behavior is unchanged
- Confirmation that user's "config-only" decision is appropriate
</output>
