# Milestone v1.2: Clarity 4 Update

**Status:** SHIPPED 2026-02-03
**Phases:** 7-8
**Total Plans:** 3

## Overview

Update smart contracts to Clarity 4 and adopt modern language idioms where beneficial.

## Phases

### Phase 7: Clarity 4 Migration

**Goal**: Counter contract runs on Clarity 4 with modern idioms applied where beneficial
**Depends on**: Phase 6 (v1.1 shipped)
**Plans**: 2 plans

Plans:
- [x] 07-01: Update Clarinet.toml configuration for Clarity 4 and verify tooling
- [x] 07-02: Review counter contract for Clarity 4 idioms and verify behavior

**Details:**
- Updated clarity_version to 4 and epoch to 3.3 for all contracts
- Multi-epoch deployment batching (epoch 3.0 for sbtc deps, 3.3 for local contracts)
- Assessed all 4 Clarity 4 features against counter contract needs
- Deferred all idiom changes - contract too minimal to benefit

### Phase 8: Validation

**Goal**: All tests pass and contract works correctly on local devnet with Clarity 4
**Depends on**: Phase 7
**Plans**: 1 plan

Plans:
- [x] 08-01: Create counter tests and verify devnet deployment

**Details:**
- Created counter.test.ts with 5 test cases
- All 16 tests pass (11 fundraising + 5 counter)
- Verified devnet deployment works correctly
- Counter contract functions correctly (increment/decrement)

---

## Milestone Summary

**Key Decisions:**
- Proceed with Clarity 4 despite clarinet check bug - tests confirm functionality
- Multi-epoch batching for sbtc requirements (3.0) and local contracts (3.3)
- No Clarity 4 idiom changes for counter - contract too minimal to benefit
- User's config-only decision validated by assessment

**Issues Resolved:**
- Clarinet 3.10.0 bug with `as-contract` false positive (workaround: use `npm test`)
- ARM64 devnet Docker issues (resolved by user)

**Issues Deferred:**
- Clarity 4 idiom adoption (counter too minimal, defer to future contracts)

**Technical Debt Incurred:**
- None

---
*For current project status, see .planning/ROADMAP.md*
